<template>
	<view>
		<view class="">
			<text class="pre-86">+86</text>
			<input class="width-750 height-100 bg-fff pd-lt100" 
			v-model="phone" type="number" maxlength="11"
			placeholder-class="color-ccc" placeholder="请填写手机号"/>
		</view>
	</view>
</template>

<script>
	// 存储用户信息
	import {mapState,mapMutations} from 'vuex';
	// 缓存管理
	import service from '@/service.js';
	// 请求抽离
	import request from '@/request/request.js';
	export default {
		data() {
			return {
				name:"", //昵称
				motto:"",//签名 
				account:'',//账号 
				phone:'', //手机号
				avatarUrl:"",//头像地址 /static/img/avatar.png
				wxId:"" //微信id
			}
		},
		onShow() {
			// 如果存在则获取数据
			if (this.userInfo) {
				let userInfo = this.userInfo;
				this.name = userInfo.name;
				this.motto = userInfo.motto;
				this.avatarUrl = userInfo.avatarUrl;
				this.phone = userInfo.phone;
				this.account = userInfo.account;
				this.wxId = userInfo.wxId;
			}
		},
		// 监听下一步按钮的点击事件
		onNavigationBarButtonTap(e){
			this.phoneChange();
		},
		methods: {
			// 存储用户信息的方法
			...mapMutations(['setInfo']),
			// 确认修改手机号
			phoneChange(){
				let phone=this.phone;
				let myreg = /^(0|86|17951)?(13[0-9]|15[012356789]|166|17[3678]|18[0-9]|14[57])[0-9]{8}$/;
				if (!myreg.test(phone)) {
					uni.showToast({
						icon: 'none',
						title: '请输入有效手机号！',
					})
				} else{
					console.log(this.phone);
					// 信息修改完毕，提交给服务器存入数据库
					request.bindPhone(this);
				}
				// 返回我的页面
				uni.reLaunch({
					url:"/pages/tabBar/profile/profile"
				})
			}
		},
		computed:{
			...mapState(['userInfo','serverUrl'])
		}
	}
</script>

<style>
	page{
		background-color: #EDF0F2;
	}
	.pre-86{
		position: absolute;
		float: left;
		top: 25upx;
		left: 10upx;
	}
</style>
