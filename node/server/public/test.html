<!DOCTYPE html>
<html lang="">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
        <title>socket连接测试</title>
        <style>
            .me{
                background-color: aqua;
            }
            .other{
                background-color: blueviolet;
            }
        </style>
    </head>
    <body>
        <input type="text" id="value">
        <input type="button" value="发消息" id="btn">
        <div id="chat">

        </div>
        <script>
            let url = 'ws://192.168.1.11:8080?sign=7af28f45da70b66e05c2aaf51e5fc48d&uid=754433271';
            let socket = new WebSocket(url);
            const uid = 754433271;
            socket.onopen = function (e) {
                console.log(e,"正常打开");
            }
            socket.onclose = function (e) {
                console.log(e,"连接关闭");
            }
            socket.onerror = function (e) {
                console.log(e,"连接出错");
            }
            socket.onmessage = function (e) {
                console.log(JSON.parse(e.data));
                data = JSON.parse(e.data);
                if(data.model && data.model == 103){
                    let msg = data.data;
                    let sign = msg.uid == uid ? 'me' : 'other';
                    let em = document.createElement('div');
                    em.setAttribute('class', sign);
                    em.innerText = msg.content;
                    let chat = document.querySelector('#chat');
                    chat.appendChild(em);
                }
            }
            let btn = document.querySelector("#btn");
            let value = document.querySelector("#value");
            btn.addEventListener('click',() => {
                // let obj = {
                //     cmd: 402,
                //     data: {
                //         roomId:3,
                //         msg: {
                //             uid,
                //             content: value.value
                //         }
                //     },
                //     cbk: 1
                // }
                let obj = {
                    cmd: 300,
                    data: {
                        uid: 754433272
                    }
                }
                socket.send(JSON.stringify(obj)); 
                value.value = '';
            });
        </script>
    </body>
</html>