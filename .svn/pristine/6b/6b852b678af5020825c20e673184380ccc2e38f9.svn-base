<template>
	<!-- 历史被赞数 -->
	<view>
		<view class="likesSum" v-for="(item,index) in lists" :key="index">
			<view class="time flex flex-jc flex-vc">
				<text>{{item.time}}</text>
			</view>
			<view class="likesList flex flex-vc" @tap="toPeopInfo(item)">
				<image :src="item.userHead" mode=""></image>
				<view class="content">
					<text class="friend_name one-line-ellipsis">{{item.user_name}}</text>
				</view>
			</view>
		</view>
	</view>

</template>

<script>
	import service from '@/service.js';
	import request from '@/request/request.js';
	export default {
		data() {
			return {
				lists: [{
						time: '今天',
						userHead: '../../../static/img/friendhead.png',
						user_name: "小敏",
						uid: ''
					},

				]
			}
		},
		onLoad() {
			// 首先从缓存中拿commendList，如果能拿到直接赋给lists,如果没有就去request请求
			uni.getStorage({
				key: "commendList",
				success: (res) => {
					console.log(res);
					this.lists = res;
				},
				fail: (res) => {
					request.getCommendList((data) => {
						this.lists = data;
						// 存入到数据库中
						uni.setStorage({
							key:"commendList",
							data:this.lists
						})
					}, (err) => {
						console.log("数据请求失败");
						console.log(err);
					}, (complete) => {
						// 关闭下拉刷新动画
						setTimeout(() => {
							uni.stopPullDownRefresh();
						}, 1000);
					});
				}
			})

		},
		methods: {

			//跳转到点赞人的详情页
			toPeopInfo(item) {
				let uid = item.uid;
				uni.navigateTo({
					url: `../../addressSubpackage/friendsInfo/friendsInfo?uid=${uid}`,
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			}
		},
		// 下拉刷新
		onPullDownRefresh() {
			console.log("下拉刷新了");
			// 从服务器拉取新数据
			request.getCommendList((data)=>{
				this.lists = data;
				// 存入到数据库中
				uni.setStorage({
					key:"commendList",
					data:this.lists
				})
			},(err)=>{
				console.log("数据请求失败");
				console.log(err);
			},(complete)=>{
				// 关闭下拉刷新动画
				setTimeout(()=>{
					uni.stopPullDownRefresh();
				},1000);
			});
		},
	}
</script>

<style>
	page {
		background-color: #F7F7F7;
	}

	.likesSum {
		width: 100%;
	}

	.time {
		width: 100%;
		height: 70upx;
		font-size: 30upx;
	}

	.likesList {
		padding: 10upx;
		background-color: #fff;
		height: 150upx;
	}

	.likesList image {
		display: inline-block;
		margin: 10upx;
		width: 100upx;
		height: 100upx;
		border: 1px solid #344955;
		border-radius: 50%;
	}

	.content {}

	.friend_name {
		width: 400upx;
	}
</style>
