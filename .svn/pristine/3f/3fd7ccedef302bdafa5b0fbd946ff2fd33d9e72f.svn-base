// 登录状态管理
import Vue from 'vue'
import Vuex from 'vuex'
// 告诉 vue “使用” vuex
Vue.use(Vuex)

const store = new Vuex.Store({
    state: {	//全局变量定义处
        /**
         * 是否需要强制登录,是 true
         */
        forcedLogin: true,
		// 是否已经登录
        hasLogin: false,
		// PHP服务器地址
		serverUrl:'http://192.168.10.136',
		// websocket服务器地址
		websocketUrl:'ws://192.168.10.136:8848',
		// 用户信息
        userInfo: {
			name:'',
			motto:'',
			account:'',
			avatarUrl:'',
			// 是否微信登录
			wxId:'',
			phone:''
		},
		// 临时用户信息(搜索)
		tempInfo: {
			name:'',
			motto:'',
			account:'',
			avatarUrl:'',
			wxId:'',
			phone:''
		},
		// 好友列表
		myFriends:[
					// [
					// 	75443327,{
					// 	name:"枯藤星际",
					// 	motto:"蒸羊羔蒸熊掌蒸鹿尾烧花鸭烧雏鸡烧子鹅卤煮",
					// 	avatarUrl:"/static/img/avatar.png",
					// 	phone:18666666666,
					// 	account:75443327,
					// 	wxId:"",
					// 	}
					// ]
				],
		// 好友圈
		findLists:[ 
					// {
					// 	id:1,
					// 	userId: 12345678,
					// 	avatar: "/static/img/finds_01.jpg",
					// 	name: "小美",
					// 	time: 1576199585544,
					// 	showTime:new Date(1576199585544).toTimeString().substr(0, 5),
					// 	dynamicImg: "/static/img/finds_01.jpg", //发布的动态图片
					// 	likesNum: 9, //点赞数
					// 	commentsNum: 15, //评论数
					// 	likeAction: false, //是否给他点赞
					// },
				],
		// 赞我的人
		likeMe:[
			// {
				// 	name:"",
				// 	avatar:"",
				//  userId:''
			// }
		],
		// 关注我的人
		followMe:[
			// {
			// 	avatar:'',
			// 	name:'',
			// 	isFocus:0
			// }
		]
    },
    mutations: {
		// 登录
        login(state) {
            state.hasLogin = true;
        },
		// 退出登录
        logout(state) {
            state.hasLogin = false;
        },
		// 设置用户信息
		setInfo(state,obj){
			for (let s in obj) {
				state.userInfo[s] = obj[s];
				console.log("存入了"+s+":"+obj[s]);
			}
		},
		// 设置搜索到的用户信息
		setInfoTemp(state,obj){
			for (let s in obj) {
				state.tempInfo[s] = obj[s];
				console.log("临时存入了"+s+":"+obj[s]);
			}
		},
		// 添加好友
		addFriend(state,obj){
			let uid=[];
			let f=[];
			for (let i in state.myFriends) {
				uid.push(state.myFriends[i][0]);
				f.push(state.myFriends[i][1]);
			}
			// 如果好友已存在
			if (uid.includes(obj.account)) {
				console.log("已经是好友了");
			} else{
				// 对象的深拷贝!!!
				state.myFriends.push([obj.account,JSON.parse(JSON.stringify(obj))]);
			}
			console.log("添加了好友"+obj.name);
			console.log(JSON.stringify(state.myFriends));
		},
		// 删除好友
		deleteFriend(state,obj){
			let uid=[];
			let f=[];
			for (let i in state.myFriends) {
				uid.push(state.myFriends[i][0]);
				f.push(state.myFriends[i][1]);
			}
			for (let i in uid) {
				if (uid[i]==obj.account) {
					// 高阶函数删除数组项
					state.myFriends=state.myFriends.filter((item)=>item[0]!=uid[i]);
				} else{
					console.log("好友不存在");
				}
			}
			console.log("删除了好友"+obj.name);
			console.log(JSON.stringify(state.myFriends));
		},
		// 从缓存列表加载好友
		addFriendFromCache(state,lists){
			// 深拷贝
			state.myFriends=JSON.parse(JSON.stringify(lists));
		},
		// 清空好友列表
		deleteAllFriend(state){
			state.myFriends.length=0;
			console.log("好友列表已清空");
		},
		// 暂存好友圈信息
		addFinds(state,lists){
			// 深拷贝
			state.findLists=JSON.parse(JSON.stringify(lists));
			console.log("好友圈信息已暂存state");
		},
		// 更新好友圈信息
		updateFinds(state,obj){
			let {id,commentsNum,likesNum}=obj;
			for (let i in state.findLists) {
				if(state.findLists[i].id==id){
					console.log(commentsNum);
					state.findLists[i].commentsNum=commentsNum;
					state.findLists[i].likesNum=likesNum;
				}
			}
		},
		// 暂存赞我的人
		addLikes(state,lists){
			// 深拷贝
			state.likeMe=JSON.parse(JSON.stringify(lists));
			console.log("赞我的人的信息已暂存");
		},
		// 暂存关注我的人
		addFocus(state,lists){
			// 深拷贝
			state.followMe=JSON.parse(JSON.stringify(lists));
			console.log("关注我的人的信息已暂存");
		}
    },
	getters:{
		serverUrl:(state)=>state.serverUrl,
		userInfo:(state)=>state.userInfo,
		tempInfo:(state)=>state.tempInfo
	}
})

export default store
