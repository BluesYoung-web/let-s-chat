<!-- 我的页面 -->
<template>
	<view class="content">
		<!-- 首部头像下的背景颜色 -->
		<view class="topBg width-full bg-344955 absolute"></view>
		<!-- 设置按钮 -->
		<view class="settingIcon width-full height-50 flex flex-je pd-lr30 pd-tp20">
			<image class="width-50 height-50" src="../../../static/img/set.png" mode="scaleToFill"></image>
		</view>
		<!-- 头像 -->
		<view class="avatar mg-tp20">
			<image :src="avatarUrl" mode="aspectFill"></image>
		</view>
		
		<!-- 昵称资料 -->
		<view class="messageContent mg-tp60 flex flex-direction-column flex-vc">
			<!-- 昵称 -->
			<view class="name ft-36 font-weight-600 color-344955 one-line-ellipsis">
				<text v-if="name">{{name}}</text>
				<text v-else class="">用户昵称</text>
			</view>
			<!-- 来聊账号 -->
			<view class="account ft-26 color-889aa3 mg-tp15">
				<text>来聊账号：</text>
				<text v-if="account">{{account}}</text>
				<text v-else>未绑定手机号，请先去设置页绑定</text>
			</view>
			<!-- 签名 -->
			<view class="motto ft-26 color-889aa3 mg-tp20 one-line-ellipsis">
				<text v-if="motto">{{motto}}</text>
				<text v-else class="">暂未设置签名</text>
			</view>
			
			<!-- 编辑资料按钮 -->
			<button class="editInfoBtn bg-889aa3 color-889aa3 mg-tp60"  plain="true" @tap="toMyInformation">编辑资料</button>
			
			<!-- 下方的赞&关注&发表 -->
			<view class="flex flex-direction-row flex-hc width-750">
				<!-- 赞 -->
				<view class="myCommend" @tap="toMyCommend">
					<text class="color-889aa3 ft-26">赞</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myCommend}}</text>
				</view>
				<!-- 关注 -->
				<view class="myFocus" @tap="toMyFocus">
					<text class="color-889aa3 ft-26">关注</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myFocus}}</text>
				</view>
				<!-- 发表 -->
				<view class="myRelease" @tap="toMyRelease">
					<text class="color-889aa3 ft-26">发表</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myRelease}}</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	import request from '@/request/request.js';
	// 存储用户信息，获取用户信息
	import {mapMutations,mapState} from 'vuex';
	export default {
		onLoad() {
			// this.myRelease=5
			// console.log(this.myRelease)
		},
		data() {
			return{
				name:"", //昵称 
				motto:"",//签名 
				account:'',//账号 
				phone:'', //手机号
				myCommend:0,//赞数
				myFocus:0,//关注
				myRelease:0,//发表
				avatarUrl:"",//头像地址 /static/img/avatar.png
				wxId:'' //微信id
			}
		},
		
		// 
		onShow() {
			let userInfo = this.userInfo;
			
			// 如果存在则获取数据
			if (userInfo) {
				this.name = userInfo.name;
				this.motto = userInfo.motto;
				this.avatarUrl = userInfo.avatarUrl;
				this.phone = userInfo.phone;
				this.account = userInfo.account;
				this.wxId = userInfo.wxId;
			}
			
			//动态获取我的发表动态数量
			request.getLatestFinds((data)=>{
					if(data){
						data = data.filter((data)=>data.userId==this.userInfo.account);
						this.myRelease=data.length;
					}
				});
			// 动态获取我被赞的个数
			request.getLikesNum(this.account,(data)=>{
				console.log(JSON.stringify(data));
				this.myCommend=data.length;
				this.addLikes(data);
			});
			// 动态获取关注我的人
			request.getFollowMe(this.account,(data)=>{
				console.log(JSON.stringify(data));
				this.myFocus=data.length;
				this.addFocus(data);
			});
			
		},
		// 监听设置按钮的点击事件
		onNavigationBarButtonTap(e){
			// 跳转到设置页面
			uni.navigateTo({
				url: `../../mySubpackage/setting/setting`,
				success: res => {},
				fail: () => {},
				complete: () => {}
			});
		},
		computed:{
			...mapState(['userInfo','serverUrl'])
		}, 
		methods: {
			// 存储用户信息的方法
			...mapMutations(['setInfo','addLikes','addFocus']),
			// 跳转到编辑资料页面
			toMyInformation:function(){
				// 先判断是否绑定了手机号
				if (this.account) {
					uni.navigateTo({
						url: `../../mySubpackage/myInformation/myInformation`,
						success: res => {},
						fail: () => {},
						complete: () => {}
					});
				} else{
					uni.showToast({
						title:"请先去设置页绑定手机号",
						icon:"none"
					})
				}
				
			},
			
			
			//---------下方的赞&关注&发表--------
			// 跳转到我收到的赞的页面
			toMyCommend:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myCommend/myCommend',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			// 跳转到关注我的页面
			toMyFocus:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myFocus/myFocus',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			// 跳转到我收到的赞的页面
			toMyRelease:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myRelease/myRelease',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
		}
	}
</script>

<style>
	/* 首部头像下的背景颜色 */
	.topBg{
		height: 350upx;
		top: 0;
		z-index: -1;
	}
	.settingIcon{
		margin-top: -100upx;
	}
	/* 头像 */
	.avatar{
		/* margin-top: -350upx; */
		width: 500upx;
		height: 500upx;
		box-shadow:0upx 2upx 50upx 0upx #344955;
	}
	.avatar image{
		width: 500upx;
		height: 500upx;
	}
	/* 编辑资料按钮 */
	.editInfoBtn{
		border: 1px solid #344955;
		border-radius: 8upx;
		width: 320upx;
		color: #344955;
	}
	/* 赞 关注 发表 */
	.myCommend,.myFocus,.myRelease{
		width: 33%;
		height: 200upx;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
	}
	
	.name, .motto{
		width: 400upx;
		text-align: center;
	}
</style>