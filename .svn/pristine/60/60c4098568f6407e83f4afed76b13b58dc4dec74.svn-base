<!-- 我的页面 -->
<template>
	<view class="content">
		<!-- <button class="mg-tp50" type="primary" @tap="toLogin">点击登录</button> -->
		<!-- 首部头像下的背景颜色 -->
		<view class="topBg width-full bg-344955 absolute"></view>
		<!-- 设置按钮 -->
		<view class="settingIcon width-full height-50 flex flex-je pd-lr30 pd-tp20">
			<image class="width-50 height-50" src="../../../static/img/set.png" mode="scaleToFill"></image>
		</view>
		<!-- 头像 -->
		<view class="avatar mg-tp20">
			<image :src="avatarUrl" mode="aspectFill"></image>
		</view>
		
		<!-- 昵称资料 -->
		<view class="messageContent mg-tp60 flex flex-direction-column flex-vc">
			<!-- 昵称 -->
			<view class="name ft-36 font-weight-600 color-344955 one-line-ellipsis">
				<text v-if="name">{{name}}</text>
				<text v-else class="">用户昵称</text>
			</view>
			<!-- 来聊账号 -->
			<view class="account ft-26 color-889aa3 mg-tp15">
				<text>来聊账号：</text>
				<text>{{account}}</text>
			</view>
			<!-- 签名 -->
			<view class="motto ft-26 color-889aa3 mg-tp20 one-line-ellipsis">
				<text v-if="motto">{{motto}}</text>
				<text v-else class="">暂未设置签名</text>
			</view>
			
			<!-- 编辑资料按钮 -->
			<button class="editInfoBtn bg-889aa3 color-889aa3 mg-tp60"  plain="true" @tap="toMyInformation">编辑资料</button>
			
			<!-- 下方的赞&关注&发表 -->
			<view class="flex flex-direction-row flex-hc width-750">
				<!-- 赞 -->
				<view class="myCommend" @tap="toMyCommend">
					<text class="color-889aa3 ft-26">赞</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myCommend}}</text>
				</view>
				<!-- 关注 -->
				<view class="myFocus" @tap="toMyFocus">
					<text class="color-889aa3 ft-26">关注</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myFocus}}</text>
				</view>
				<!-- 发表 -->
				<view class="myRelease" @tap="toMyRelease">
					<text class="color-889aa3 ft-26">发表</text>
					<text class="color-4A6572 ft-28 mg-tp15">{{myRelease}}</text>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	// 存储用户信息，获取用户信息
	import {mapMutations,mapState} from 'vuex'
	export default {
		data() {
			return{
				name:"", //昵称 青青草原扛把子
				motto:"",//签名 当然是选择原谅她啊
				account:'',//账号 10193758
				phone:'',
				myCommend:22,//赞数
				myFocus:88,//关注
				myRelease:108,//发表
				avatarUrl:"",//头像地址 /static/img/avatar.png
			}
		},
		// 
		onShow() {
			// 如果存在则获取数据
			if (this.userInfo) {
				let userInfo = this.userInfo;
				this.name = userInfo.name;
				this.motto = userInfo.motto;
				this.avatarUrl = userInfo.avatarUrl;
			}
		},
		// 从服务器获取数据，并将数据存入state
		onLoad() {
			// 从服务器获取数据
			uni.request({
				url:`${this.serverUrl}?op=getUserInfo`,
				method: 'GET',
				data: {},
				success: res => {
					let userInfo=res.data;
					this.name = userInfo.user_name;
					this.motto = userInfo.user_motto;
					this.account = userInfo.user_uid;
					this.avatarUrl = userInfo.user_avatar;
					this.phone = userInfo.user_phone;
					// 将数据存入state
					let temp={
						name:this.name,
						motto:this.motto,
						account:this.account,
						avatarUrl:this.avatarUrl,
						phone:this.phone
					};
					this.setInfo(temp);
				},
				fail: () => {},
				complete: () => {}
			});
			
		},
		// 监听设置按钮的点击事件
		onNavigationBarButtonTap(e){
			// 跳转到设置页面
			uni.navigateTo({
				url: `../../mySubpackage/setting/setting`,
				success: res => {},
				fail: () => {},
				complete: () => {}
			});
		},
		computed:{
			...mapState(['userInfo','serverUrl'])
		}, 
		methods: {
			// 存储用户信息的方法
			...mapMutations(['setInfo']),
			// 跳转到编辑资料页面
			toMyInformation:function(){
				uni.navigateTo({
					url: `../../mySubpackage/myInformation/myInformation`,
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			
			
			//---------下方的赞&关注&发表--------
			// 跳转到我收到的赞的页面
			toMyCommend:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myCommend/myCommend',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			// 跳转到关注我的页面
			toMyFocus:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myFocus/myFocus',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			// 跳转到我收到的赞的页面
			toMyRelease:function(){
				uni.navigateTo({
					url: '../../mySubpackage/myRelease/myRelease',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
		}
	}
</script>

<style>
	/* 首部头像下的背景颜色 */
	.topBg{
		height: 350upx;
		top: 0;
		z-index: -1;
	}
	.settingIcon{
		margin-top: -100upx;
	}
	/* 头像 */
	.avatar{
		/* margin-top: -350upx; */
		width: 500upx;
		height: 500upx;
		box-shadow:0upx 2upx 50upx 0upx #344955;
	}
	.avatar image{
		width: 500upx;
		height: 500upx;
	}
	/* 编辑资料按钮 */
	.editInfoBtn{
		border: 1px solid #344955;
		border-radius: 8upx;
		width: 320upx;
		color: #344955;
	}
	/* 赞 关注 发表 */
	.myCommend,.myFocus,.myRelease{
		width: 33%;
		height: 200upx;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
	}
	
	.name, .motto{
		width: 400upx;
		text-align: center;
	}
</style>