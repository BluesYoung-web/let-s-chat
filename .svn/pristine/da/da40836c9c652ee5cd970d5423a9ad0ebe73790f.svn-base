<template>
	<!-- 消息页面  -->
    <scroll-view :scroll-y="isScroll">
		<block :key="index" v-for="(item, index) in dataList">
			<view class="message-row" @tap="toConversation"  @touchstart.capture="touchS" @touchmove="touchM" @touchend.capture="touchE" :data-index="index" :style="{right:item.right + 'upx'}" >
				<view class="friend-message" >			
					<view class="message-head">
						<image src="../../../static/img/logo.png"></image>
					</view>
					<view class="message-body">
						<view class="message-informatin">
							<span class="message-username">{{item.username}}</span>
							<span class="message-time">{{item.time}}</span>
						</view>
						<view class="message-content one-line-ellipsis">{{item.content}}</view>
					</view>	
				</view>
				<view class="message-delete" @tap="deleteMessage">
					删除对话
				</view>
			</view>
		</block>
	</scroll-view>    
</template>

<script>
	export default {
		data() {
			return {
				isScroll: true,
				// 前台用户标志
				delBtnWidth: 160, //删除按钮宽度
				startX:'',
				dataList:[
				{
					username:"用户昵称0",
					time:"消息接收时间",
					content:"消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容",
					right: 0
				},
				{
					username:"用户昵称1",
					time:"消息接收时间",
					content:"消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容",
					right: 0
				},
				{
					username:"用户昵称2",
					time:"消息接收时间",
					content:"消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容",
					right: 0
				},
				{
					username:"用户昵称3",
					time:"消息接收时间",
					content:"消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容消息内容",
					right: 0
				}
				]
				
				
			}
		},
		onLoad() {
			
		},
		methods: {
			toConversation:function(){
				uni.navigateTo({
					url: '../../messageSubpackage/conversation',
					success: res => {},
					fail: () => {},
					complete: () => {}
				});
			},
			deleteMessage:function(){
				console.log('delete')
			},
			// 触摸开始
			touchS:function (e) {
				// console.log('S')
                var touch = e.touches[0];
                            for (var index in this.dataList) {
                                this.dataList[index].right = 0;
                            }
                            this.startX = touch.clientX;
							// console.log(this.dataList[index].right)
            },
			touchM:function(e){
				// console.log('M')
				var touch = e.touches[0];
				            var item = this.dataList[e.currentTarget.dataset.index];
				            var disX = this.startX - touch.clientX;
				// console.log(disX)
				            if (disX >=20) {
				                    if(disX>this.delBtnWidth){
										disX = this.delBtnWidth;
									}
				                
				                this.isScroll = false;
				                this.dataList[e.currentTarget.dataset.index].right = disX;
								// console.log(this.dataList[e.currentTarget.dataset.index])
				            } else {
				                this.isScroll = true;
				                this.dataList[e.currentTarget.dataset.index].right = 0;
				            }
			},
			touchE: function (e) {
				// console.log('E') 
				var item = this.dataList[e.currentTarget.dataset.index];
				// console.log(item.right)
				            if (item.right >= this.delBtnWidth / 2) {
				                this.isScroll = true;
				                this.dataList[e.currentTarget.dataset.index].right = this.delBtnWidth;
				            } else {
				                this.isScroll = true;
				                this.dataList[e.currentTarget.dataset.index].right = 0;
				            }
							console.log(item.right)
			},
			
			
			
			
			
			
		}
	}
</script>


<style>	
	.message-row{
		width: 100%;
		height: 150upx;
		position: relative;
		background-color: #FFFFFF;
		display: flex;
	}
	.friend-message{
		width: 100%;
		display: flex;
	}
	.message-delete{
		width: 160upx;
		height: 150upx;
		position: absolute;
		top: 0;
		right: -160upx;
		color: #FFFFFF;
		font-size: 25upx;
		background-color: #eb5757;
		display: flex;
		align-items: center;
		justify-content: center;
	}
		
	.message-head{
		width: 18%;
		display: flex;
		align-items: center;
		justify-content: flex-end;		
		padding-right: 20upx;
	}
	.message-head image{
		width: 80upx;
		height: 80upx;
		border: 1px solid #344955;
		border-radius: 50%;
	}
	.message-body{
		margin-top: 20upx;
		width: 82%;
	}
	.message-username{		
		font-size: 28upx;
		font-weight: bold;
	}
	.message-time{		
		float: right;
		margin-right: 10upx;
	    color: #939393;
		font-size: 20upx;
	}
	.message-content{
		margin-top: 10upx;
		font-size: 10px;
		width: 68%;
	}
</style>
